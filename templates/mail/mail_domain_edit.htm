<div class="row">

    <tmpl_if name="is_admin">
        <div class="col-md-3">
            <div class="form-group">
                <tmpl_if name="edit_disabled">
                    <label for="server_id_disabled" class="control-label">{tmpl_var name='server_id_txt'}</label>
                    <select name="server_id_disabled" id="server_id_disabled" class="form-control" disabled="disabled">
                        {tmpl_var name='server_id'}
                    </select>
                    <input type="hidden" name="server_id" value="{tmpl_var name='server_id_value'}" />
                    <tmpl_else>
                        <label for="server_id" class="control-label">{tmpl_var name='server_id_txt'}</label>
                        <select name="server_id" id="server_id" class="form-control">
                            {tmpl_var name='server_id'}
                        </select>
                </tmpl_if>
            </div>
        </div>
        <tmpl_if name="domain_option">
            <div class="col-md-3">
                <div class="form-group">
                    <label for="client_group_id" class="control-label">{tmpl_var name='client_txt'}</label>
                    <select name="server_id_disabled" id="server_id_disabled" class="form-control" disabled="disabled">
                        {tmpl_var name='client_group_name'}
                    </select>
                </div>
            </div>
            <tmpl_else>
                <div class="col-md-3">
                    <div class="form-group">
                        <label for="client_group_id" class="control-label">{tmpl_var name='client_txt'}</label>
                        <select name="client_group_id" id="client_group_id" class="form-control">
                            {tmpl_var name='client_group_id'}
                        </select>
                    </div>
                </div>
        </tmpl_if>
        <tmpl_else>
            <tmpl_if name="only_one_server">
                <input type="hidden" id="server_id" name="server_id" value="{tmpl_var name='server_id_value'}" />
                <tmpl_else>
                    <div class="col-md-3">
                        <div class="form-group">
                            <tmpl_if name="edit_disabled">
                                <label for="server_id_disabled" class="control-label">{tmpl_var name='server_id_txt'}</label>
                                <select name="server_id_disabled" id="server_id_disabled" class="form-control" disabled="disabled">
                                    {tmpl_var name='client_server_id'}
                                </select>
                                <input type="hidden" name="server_id" value="{tmpl_var name='server_id_value'}" />
                                <tmpl_else>
                                    <label for="server_id" class="control-label">{tmpl_var name='server_id_txt'}</label>
                                    <select name="server_id" id="server_id" class="form-control">
                                        {tmpl_var name='client_server_id'}
                                    </select>
                            </tmpl_if>
                        </div>
                    </div>
            </tmpl_if>
    </tmpl_if>

    <tmpl_if name="is_reseller">
        <tmpl_unless name="domain_option">
            <div class="col-md-3">
                <div class="form-group">
                    <label for="client_group_id" class="control-label">{tmpl_var name='client_txt'}</label>
                    <select name="client_group_id" id="client_group_id" class="form-control">
                        {tmpl_var name='client_group_id'}
                    </select>
                </div>
            </div>
        </tmpl_unless>
    </tmpl_if>
</div>
<div class="row">
    <div class="col-md-3">
        <div class="form-group">
            <label for="domain" class="control-label">{tmpl_var name='domain_txt'}</label>
            <tmpl_if name="domain_option">
                <select name="domain" id="domain" class="form-control">
                    {tmpl_var name='domain_option'}
                </select>
                <tmpl_else>
                    <input type="text" name="domain" id="domain" value="{tmpl_var name='domain'}" class="form-control" />
            </tmpl_if>
        </div>
    </div>
    <div class="col-md-3">
        <div class="form-group">
            <label for="policy" class="control-label">{tmpl_var name='policy_txt'}</label>
            <select name="policy" id="policy" class="form-control">
                {tmpl_var name='policy'}
            </select>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-3">
        <div class="form-check custom">
            {tmpl_var name='active'}
            <label class="form-check-label">
                {tmpl_var name='active_txt'}
            </label>
        </div>
    </div>
</div>
<div class="row">
    <tmpl_if name="domain_module">
        <input type="hidden" name="domain_module" value="1" id="domain_module" />
        <tmpl_else>
            <input type="hidden" name="domain_module" value="0" id="domain_module" />
    </tmpl_if>
    <div class="col-sm-12">
        <button class="btn btn-default formbutton-default" type="button" data-toggle="collapse" data-target="#toggle-dkim" aria-expanded="false" aria-controls="toggle-dkim">{tmpl_var name='dkim_settings_txt'}</button>
    </div>
</div>
<div id="toggle-dkim" class="collapse">
    <div class="row">
        <div class="col-md-3">
            <div class="form-group">
                <label class="control-label">{tmpl_var name='dkim_txt'}</label>
                {tmpl_var name='dkim'}

            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="dkim_selector" class="control-label">{tmpl_var name='dkim_selector_txt'}</label>
                <input type="text" name="dkim_selector" id="dkim_selector" value="{tmpl_var name='dkim_selector'}" class="form-control" /></div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="dkim_private" class="control-label">{tmpl_var name='dkim_private_txt'}</label>
                <textarea class="form-control" name="dkim_private" id="dkim_private" rows='10' cols='30'>{tmpl_var name='dkim_private'}</textarea>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <a class="btn btn-default formbutton-default" id="dkim-button" value="{tmpl_var name='dkim_generate_txt'}">{tmpl_var name='dkim_generate_txt'}</a>
            <div class="form-group">
                <textarea class="form-control" name="dkim_public" style="display:none;" id="dkim_public" rows='5' cols='30' readonly>{tmpl_var name='dkim_public'}</textarea>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="dns_record" class="control-label">{tmpl_var name='dkim_dns_txt'}</label>
                <textarea class="form-control" name="dns_record" id="dns_record" rows='10' cols='30' readonly>{tmpl_var name='dns_record'}</textarea>
            </div>
        </div>
    </div>
</div>
</div>

<div class="row">
    <div class="col-md-6">
        <input type="hidden" name="id" value="{tmpl_var name='id'}">
        <input type="hidden" name="type" value="local">
        <div class="float-right" style="padding-top: 1rem; padding-bottom: 1rem;">
            <button class="btn btn-default formbutton-success" type="button" value="{tmpl_var name='btn_save_txt'}" data-submit-form="pageForm" data-form-action="mail/mail_domain_edit.php">{tmpl_var name='btn_save_txt'}</button>
            <button class="btn btn-default formbutton-default" type="button" value="{tmpl_var name='btn_cancel_txt'}" data-load-content="mail/mail_domain_list.php">{tmpl_var name='btn_cancel_txt'}</button>
        </div>
    </div>
</div>

<script language="JavaScript" type="text/javascript">
    $("#dkim-button").click(function () { getDKIM(); });

    function getDKIM() {
        var domain_id = jQuery('#domain').val();
        var dkim_selector = jQuery('#dkim_selector').val();
        var dkim_public = jQuery('#dkim_public').val();
        jQuery.getJSON('mail/ajax_get_json.php' + '?' + Math.round(new Date().getTime()), {
            domain_id: domain_id,
            dkim_public: dkim_public,
            dkim_selector: dkim_selector,
            type: "create_dkim"
        }, function (data) {
            var dkim_txt = 'v=DKIM1; t=s; p=' + data['dns_record'].replace(/(\r\n|\n|\r)/gm, "");
            var dns = data['dkim_selector'] + '._domainkey.' + data['domain'] + '. 3600   IN	TXT	' + dkim_txt.match(new RegExp('.{1,' + '200' + '}', 'g')).map(chunk => '"' + chunk + '"').join('');

            $("#dkim_selector").val(data.dkim_selector);
            $("#dkim_public").val(data.dkim_public);
            $("#dkim_private").val(data.dkim_private);
            $("#dns_record").val(dns);
        });
    };
</script>