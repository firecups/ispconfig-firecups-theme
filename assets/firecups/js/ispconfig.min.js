var ISPConfig={pageFormChanged:!1,tabChangeWarningTxt:"",tabChangeDiscardTxt:"",tabChangeWarning:!1,tabChangeDiscard:!1,requestsRunning:0,indicatorCompleted:!1,registeredHooks:new Array,new_tpl_add_id:0,dataLogTimer:0,bootboxOpen:0,options:{useLoadIndicator:!1,useComboBox:!1},setOption:function(key,value){ISPConfig.options[key]=value},setOptions:function(opts){$.extend(ISPConfig.options,opts)},reportError:function(request){},registerHook:function(name,callback){ISPConfig.registeredHooks[name]||(ISPConfig.registeredHooks[name]=new Array);var newindex=ISPConfig.registeredHooks[name].length;ISPConfig.registeredHooks[name][newindex]=callback},callHook:function(name,params){if(ISPConfig.registeredHooks[name])for(var i=0;i<ISPConfig.registeredHooks[name].length;i++){var callback;(0,ISPConfig.registeredHooks[name][i])(name,params)}},resetFormChanged:function(){ISPConfig.pageFormChanged=!1},showLoadIndicator:function(){if(document.body.style.cursor="wait",1==ISPConfig.options.useLoadIndicator&&(ISPConfig.requestsRunning+=1,ISPConfig.requestsRunning<2)){var indicator=$("#ajaxloader");indicator.length<1&&(indicator=$('<div id="ajaxloader" style="display: none;"></div>')).appendTo("body");var parent=$("#content");if(parent.length<1)return;ISPConfig.indicatorCompleted=!1;var atx=parent.offset().left+150,aty=parent.offset().top+150;$(".loader-overlay").show(),indicator.fadeIn("fast",(function(){ISPConfig.indicatorCompleted=!0,ISPConfig.requestsRunning<1&&$(this).fadeOut("fast",(function(){$(this).hide(),$(".loader-overlay").hide()}))}))}},hideLoadIndicator:function(){document.body.style.cursor="",ISPConfig.requestsRunning-=1,ISPConfig.requestsRunning<1&&(ISPConfig.requestsRunning=0,1==ISPConfig.indicatorCompleted&&$("#ajaxloader").fadeOut("fast",(function(){$("#ajaxloader").hide(),$(".loader-overlay").hide()})))},onAfterSideNavLoaded:function(){setNavigationIcons(),1==ISPConfig.options.useComboBox&&$("#sidebar").find("select:not(.chosen-select)").select2({placeholder:"",width:"90%",selectOnBlur:!0,allowClear:!0})},onAfterContentLoad:function(url,data){data=data?"&"+data:"",1==ISPConfig.options.useComboBox&&(setSelect2Box(".main-content",""),setSelect2Box("#pageContent","form")),$('input[data-input-element="date"]').datetimepicker({language:"en",todayHighlight:!0,todayBtn:"linked",bootcssVer:3,fontAwesome:!0,autoclose:!0,minView:"month"}),$('input[data-input-element="datetime"]').datetimepicker({language:"en",todayHighlight:!0,todayBtn:"linked",bootcssVer:3,fontAwesome:!0,autoclose:!0}),$('[data-toggle="tooltip"]').tooltip({}),$('input[type="password"]').each((function(){$(this).prop("readonly",!0).tooltip({title:"Click to set",placement:"left"})})),$('input[type="password"]').on("click focus",(function(){$(this).prop("readonly",!1),$(this).tooltip("destroy")})),ISPConfig.callHook("onAfterContentLoad",{url:url,data:data})},submitForm:function(formname,target,confirmation){var successMessage=arguments[3];if(confirmation||(confirmation=!1),!confirmation||window.confirm(confirmation))var submitFormObj=$.ajax({type:"POST",url:target,data:$("#"+formname).serialize(),dataType:"html",beforeSend:function(){ISPConfig.showLoadIndicator()},success:function(data,textStatus,jqXHR){if(successMessage&&(ISPConfig.bootboxOpen=1,bootbox.alert({message:"successMessage",callback:function(){ISPConfig.bootboxOpen=0}})),jqXHR.responseText.indexOf("HEADER_REDIRECT:")>-1){var parts=jqXHR.responseText.split(":");ISPConfig.loadContent(parts[1])}else jqXHR.responseText.indexOf("LOGIN_REDIRECT:")>-1?document.location.href="./index.php":($("#pageContent").html(jqXHR.responseText),ISPConfig.onAfterContentLoad(target,$("#"+formname).serialize()),ISPConfig.pageFormChanged=!1);clearTimeout(ISPConfig.dataLogTimer),ISPConfig.dataLogNotification(),ISPConfig.hideLoadIndicator()},error:function(jqXHR,textStatus,errorThrown){ISPConfig.hideLoadIndicator();var parts=jqXHR.responseText.split(":");ISPConfig.reportError("Ajax Request was not successful. 111")}})},submitUploadForm:function(formname,target){var handleResponse=function(loadedFrame){var response,responseStr=loadedFrame.contentWindow.document.body.innerHTML;try{response=JSON.parse(responseStr)}catch(e){response=responseStr}var $response=$("<div></div>").html(response),msg="",okmsg=$response.find("#OKMsg").html();okmsg&&(msg='<div id="OKMsg">'+okmsg+"</div>");var errormsg=$response.find("#errorMsg").html();errormsg&&(msg=msg+'<div id="errorMsg">'+errormsg+"</div>");var csrf_key=$response.find('input[name="_csrf_key"]').val(),csrf_id;return msg=msg+'<input type="hidden" name="_csrf_id" value="'+$response.find('input[name="_csrf_id"]').val()+'" /><input type="hidden" name="_csrf_key" value="'+csrf_key+'" />'},frame_id="ajaxUploader-iframe-"+Math.round((new Date).getTime()/1e3);$("body").append('<iframe width="0" height="0" style="display:none;" name="'+frame_id+'" id="'+frame_id+'"/>'),$("#"+frame_id).load((function(){var msg=handleResponse(this);$("#errorMsg").remove(),$("#OKMsg").remove(),$('input[name="_csrf_key"]').remove(),$('input[name="_csrf_id"]').remove(),$('input[name="id"]').before(msg),$(this).remove()})),$('input[type="file"]').closest("form").attr({target:frame_id,action:target}).submit()},capp:function(module,redirect){var submitFormObj=$.ajax({type:"GET",url:"capp.php",data:"mod="+module+(null!=redirect?"&redirect="+redirect:""),dataType:"html",beforeSend:function(){ISPConfig.showLoadIndicator()},success:function(data,textStatus,jqXHR){if(""!=jqXHR.responseText)if(jqXHR.responseText.indexOf("HEADER_REDIRECT:")>-1){var parts=jqXHR.responseText.split(":");ISPConfig.loadContent(parts[1])}else if(jqXHR.responseText.indexOf("URL_REDIRECT:")>-1){var newUrl=jqXHR.responseText.substr(jqXHR.responseText.indexOf("URL_REDIRECT:")+"URL_REDIRECT:".length);document.location.href=newUrl}ISPConfig.loadMenus(),ISPConfig.hideLoadIndicator()},error:function(){ISPConfig.hideLoadIndicator(),ISPConfig.reportError("Ajax Request was not successful."+module)}})},loadContent:function(pagename){var params=arguments[1],pageContentObject2=$.ajax({type:"GET",url:pagename,data:params||null,dataType:"html",beforeSend:function(){ISPConfig.showLoadIndicator()},success:function(data,textStatus,jqXHR){if(jqXHR.responseText.indexOf("HEADER_REDIRECT:")>-1){var parts=jqXHR.responseText.split(":");ISPConfig.loadContent(parts[1])}else if(jqXHR.responseText.indexOf("URL_REDIRECT:")>-1){var newUrl=jqXHR.responseText.substr(jqXHR.responseText.indexOf("URL_REDIRECT:")+"URL_REDIRECT:".length);document.location.href=newUrl}else $("#pageContent").html(jqXHR.responseText),ISPConfig.onAfterContentLoad(pagename,params||null),ISPConfig.pageFormChanged=!1;clearTimeout(ISPConfig.dataLogTimer),ISPConfig.dataLogNotification(),ISPConfig.hideLoadIndicator()},error:function(){ISPConfig.hideLoadIndicator(),ISPConfig.reportError("Ajax Request was not successful. 113")}})},loadContentRefresh:function(pagename){if($("#refreshinterval").val()>0){var pageContentObject2=$.ajax({type:"GET",url:pagename,data:"refresh="+document.getElementById("refreshinterval").value,dataType:"html",beforeSend:function(){ISPConfig.showLoadIndicator()},success:function(data,textStatus,jqXHR){ISPConfig.hideLoadIndicator(),$("#pageContent").html(jqXHR.responseText),ISPConfig.onAfterContentLoad(pagename,"refresh="+document.getElementById("refreshinterval").value),ISPConfig.pageFormChanged=!1},error:function(){ISPConfig.hideLoadIndicator(),ISPConfig.reportError("Ajax Request was not successful."+pagename)}});setTimeout("ISPConfig.loadContentRefresh('"+pagename+"&refresh="+document.getElementById("refreshinterval").value+"')",1e3*document.getElementById("refreshinterval").value*60)}},loadInitContent:function(){var startpage=$("#pageContent").attr("data-startpage");startpage||(startpage="dashboard/dashboard.php");var pageContentObject=$.ajax({type:"GET",url:startpage,data:"",dataType:"html",beforeSend:function(){ISPConfig.showLoadIndicator()},success:function(data,textStatus,jqXHR){if(jqXHR.responseText.indexOf("HEADER_REDIRECT:")>-1){var parts=jqXHR.responseText.split(":");ISPConfig.loadContent(parts[1])}else $("#pageContent").html(jqXHR.responseText),ISPConfig.onAfterContentLoad("dashboard/dashboard.php",""),ISPConfig.pageFormChanged=!1;ISPConfig.hideLoadIndicator()},error:function(){ISPConfig.hideLoadIndicator(),ISPConfig.reportError("Ajax Request was not successful. 114")}});ISPConfig.loadMenus(),ISPConfig.keepalive(),ISPConfig.dataLogNotification(),setTimeout((function(){try{$("form#pageForm").find('input[name="username"]').focus()}catch(e){}}),1e3)},loadMenus:function(){var sideNavObject=$.ajax({type:"GET",url:"nav.php",data:"nav=side",dataType:"html",beforeSend:function(){ISPConfig.showLoadIndicator()},success:function(data,textStatus,jqXHR){ISPConfig.hideLoadIndicator(),$("#sidebar").html(jqXHR.responseText),ISPConfig.onAfterSideNavLoaded(),ISPConfig.loadPushyMenu()},error:function(){ISPConfig.hideLoadIndicator(),ISPConfig.reportError("Ajax Request was not successful. 115")}}),topNavObject=$.ajax({type:"GET",url:"nav.php",data:"nav=top",dataType:"html",beforeSend:function(){ISPConfig.showLoadIndicator()},success:function(data,textStatus,jqXHR){ISPConfig.hideLoadIndicator(),$("#topnav-container").html(jqXHR.responseText),ISPConfig.loadPushyMenu()},error:function(o){ISPConfig.hideLoadIndicator(),ISPConfig.reportError("Ajax Request was not successful. 116")}})},changeTab:function(tab,target,force){if(ISPConfig.requestsRunning>0)return console.log("tab change interrupted, request still running."),!1;document.pageForm.next_tab.value=tab;var idel=$("form#pageForm").find('[name="id"]'),id=null;if(idel.length>0&&(id=idel.val()),"y"!=ISPConfig.tabChangeDiscard||force)if(id&&"y"==ISPConfig.tabChangeWarning&&1==ISPConfig.pageFormChanged)if(window.confirm(ISPConfig.tabChangeWarningTxt))ISPConfig.submitForm("pageForm",target);else{var next_tab=tab;id?ISPConfig.loadContent(target,{next_tab:next_tab,id:id}):ISPConfig.loadContent(target,{next_tab:next_tab})}else ISPConfig.submitForm("pageForm",target);else{if(!(idel.length<1||id)||0!=ISPConfig.pageFormChanged&&!window.confirm(ISPConfig.tabChangeDiscardTxt))return!1;var next_tab=tab;id?ISPConfig.loadContent(target,{next_tab:next_tab,id:id}):ISPConfig.loadContent(target,{next_tab:next_tab})}},confirm_action:function(link,confirmation){ISPConfig.bootboxOpen=1,bootbox.confirm({message:confirmation,buttons:{confirm:{label:"Yes",className:"btn-success"},cancel:{label:"No",className:"btn-danger"}},callback:function(result){1==result&&(console.log("This was logged in the callback: "+result),ISPConfig.loadContent(link),ISPConfig.bootboxOpen=0)}})},loadContentInto:function(elementid,pagename){var pageContentObject2=$.ajax({type:"GET",url:pagename,dataType:"html",beforeSend:function(){},success:function(data,textStatus,jqXHR){$("#"+elementid).html(jqXHR.responseText)},error:function(){ISPConfig.reportError("Ajax Request was not successful. 118")}})},loadOptionInto:function(elementid,pagename,callback){var pageContentObject2=$.ajax({type:"GET",url:pagename,dataType:"html",beforeSend:function(){},success:function(data,textStatus,jqXHR){var teste,elemente=jqXHR.responseText.split("#");el=document.getElementById(elementid),el.innerHTML="";for(var i=0;i<elemente.length;++i){var foo2=document.createElement("option");foo2.appendChild(document.createTextNode(elemente[i])),foo2.value=elemente[i],el.appendChild(foo2)}void 0!==callback&&callback(elementid,pagename)},error:function(){ISPConfig.reportError("Ajax Request was not successful. 119")}})},keepalive:function(){var pageContentObject3=$.ajax({type:"GET",url:"keepalive.php",dataType:"html",success:function(data,textStatus,jqXHR){setTimeout((function(){ISPConfig.keepalive()}),1e6)},error:function(){ISPConfig.reportError("Session expired. Please login again.")}})},dataLogNotification:function(){var notificationContent=$.ajax({type:"GET",url:"datalogstatus.php",dataType:"json",success:function(data,textStatus,jqXHR){var dataLogItems=[];$.each(data.entries,(function(key,val){dataLogItems.push("<li><strong>"+val.text+":</strong> "+val.count+"</li>")})),data.count>0?($(".modal-body").html(dataLogItems.join("")),$(".notification_text").text(data.count),$(".notification").css("display",""),ISPConfig.dataLogTimer=setTimeout((function(){ISPConfig.dataLogNotification()}),2e3)):($(".notification").css("display","none"),0==ISPConfig.bootboxOpen&&$(".modal-body").html(""),$("#datalogModal").modal("hide"),ISPConfig.dataLogTimer=setTimeout((function(){ISPConfig.dataLogNotification()}),5e3))},error:function(){ISPConfig.reportError("Notification not loading, aborting."),$(".notification").css("display","none")}})},addAdditionalTemplate:function(){var tpl_add=$("#template_additional").val(),addTemplate=$("#tpl_add_select").val().split("|",2),addTplId=addTemplate[0],addTplText=addTemplate[1];if(addTplId>0){var newVal=tpl_add.split("/");ISPConfig.new_tpl_add_id+=1;var delbtn=$('<a href="#"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></a>').attr("class","btn btn-danger btn-xs").click((function(e){e.preventDefault(),ISPConfig.delAdditionalTemplate($(this).parent().attr("rel"))}));newVal[newVal.length]="n"+ISPConfig.new_tpl_add_id+":"+addTplId,$("<li>"+addTplText+"</li>").attr("rel","n"+ISPConfig.new_tpl_add_id).append(delbtn).appendTo("#template_additional_list ul"),$("#template_additional").val(newVal.join("/"))}else ISPConfig.bootboxOpen=1,bootbox.alert({message:"no additional template selected",callback:function(){ISPConfig.bootboxOpen=0}})},delAdditionalTemplate:function(tpl_id){var tpl_add=$("#template_additional").val();if(tpl_id){var $el=$("#template_additional_list ul").find('li[rel="'+tpl_id+'"]').eq(0),addTplText=$el.text();$el.remove();for(var oldVal=tpl_add.split("/"),newVal=new Array,i=0;i<oldVal.length;i++){var tmp=oldVal[i].split(":",2);2==tmp.length&&tmp[0]==tpl_id||(newVal[newVal.length]=oldVal[i])}$("#template_additional").val(newVal.join("/"))}else if(""!=tpl_add){var addTemplate=document.getElementById("tpl_add_select").value.split("|",2),addTplId=addTemplate[0],addTplText=addTemplate[1];$("#template_additional_list ul").find("li:not([rel])").each((function(){var text;return $(this).text()==addTplText?($(this).remove(),!1):this}));var newVal=tpl_add,repl=new RegExp("(^|/)"+addTplId+"(/|$)");newVal=(newVal=newVal.replace(repl,"")).replace("//","/"),$("#template_additional").val(newVal)}else ISPConfig.bootboxOpen=1,bootbox.alert({message:"no additional template selected",callback:function(){ISPConfig.bootboxOpen=0}})}};$(document).on("change",(function(event){var elName=event.target.localName;$("#pageForm .table #Filter").length>0&&"select"==elName&&(event.preventDefault(),$("#pageForm .table #Filter").trigger("click")),"select"!=elName&&"input"!=elName&&"textarea"!=elName||0==$(event.target).hasClass("no-page-form-change")&&(ISPConfig.pageFormChanged=!0)}));var $page=$("html, body");$(document).on("click","a[data-load-content],button[data-load-content]",(function(e){if(e.preventDefault(),ISPConfig.requestsRunning>0)console.log("preventing click because there is still a request running.");else{$page.on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove",(function(){$page.stop()})),$page.animate({scrollTop:0},1e3,(function(){$page.off("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove",(function(){$page.stop()}))}));var content_to_load=$(this).attr("data-load-content");if(!content_to_load)return this;ISPConfig.loadContent(content_to_load)}})),$(document).on("click","a[data-capp],button[data-capp]",(function(e){if(e.preventDefault(),ISPConfig.requestsRunning>0)console.log("preventing click because there is still a request running.");else{$page.on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove",(function(){$page.stop()})),$page.animate({scrollTop:0},1e3,(function(){$page.off("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove",(function(){$page.stop()}))}));var content_to_load=$(this).attr("data-capp");if(!content_to_load)return this;ISPConfig.capp(content_to_load)}})),$(document).on("click","a[data-submit-form],button[data-submit-form]",(function(e){if(e.preventDefault(),ISPConfig.requestsRunning>0)console.log("preventing click because there is still a request running.");else{$page.on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove",(function(){$page.stop()})),$page.animate({scrollTop:0},1e3,(function(){$page.off("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove",(function(){$page.stop()}))}));var $el=$(this),act=$el.attr("data-form-action"),form=$el.attr("data-submit-form");"true"==$el.attr("data-form-upload")?ISPConfig.submitUploadForm(form,act):ISPConfig.submitForm(form,act)}})),$(document).bind("keypress",(function(event){"13"==event.which&&$("#pageForm .table #Filter").length>0&&0==$(event.target).hasClass("ui-autocomplete-input")&&(event.preventDefault(),$("#pageForm .table #Filter").trigger("click")),"13"==event.which&&$(".tab-content button.formbutton-success").length>0&&"textarea"!=event.target.localName&&$(event.target).is(":input")&&(event.preventDefault(),$(".tab-content button.formbutton-success").not("[disabled='disabled']").trigger("click"))})),$(document).on("click","th[data-column]",(function(e){var $self=$(this),column=$self.attr("data-column");if(!column)return this;if($("#pageForm .table #Filter").length>0&&"false"!=$self.attr("data-sortable")){var $el=$("#Filter"),act=$el.attr("data-form-action"),form=$el.attr("data-submit-form"),dir=$self.attr("data-ordered"),separator="?";act.indexOf("?")>=0&&(separator="&"),act=act+separator+"orderby="+column,ISPConfig.submitForm(form,act),$(document).ajaxComplete((function(){var $self=$('#pageForm .table th[data-column="'+column+'"]');$self.parent().children("th[data-column]").removeAttr("data-ordered"),dir&&"asc"==dir?$self.attr("data-ordered","desc"):$self.attr("data-ordered","asc")}))}})),$(document).on("click",".addPlaceholder",(function(){console.log("bla");var placeholderText=$(this).text();console.log(placeholderText);var template=$(this).siblings(":input");console.log(template),template.insertAtCaret(placeholderText)})),$(document).on("click",".addPlaceholderContent",(function(){var placeholderContentText=$(this).find(".addPlaceholderContent").text(),template2;$(this).siblings(":input").insertAtCaret(placeholderContentText)})),$(document).on("click","[data-check-fields] > input[type='checkbox']",(function(){if($(this).is(":checked"))for(var flds,tmp=$(this).parent().attr("data-check-fields").split(/,/),i=0;i<tmp.length;i++){var fname=tmp[i];$('input[type="checkbox"][name="'+fname+'"]').prop("checked",!0)}})),$(document).on("click","[data-uncheck-fields] > input[type='checkbox']",(function(){if(0==$(this).is(":checked"))for(var flds,tmp=$(this).parent().attr("data-uncheck-fields").split(/,/),i=0;i<tmp.length;i++){var fname=tmp[i];$('input[type="checkbox"][name="'+fname+'"]').prop("checked",!1)}})),$(document).on("ready",(function(){$.fn.extend({insertAtCaret:function(myValue){return this.each((function(i){if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=myValue,this.focus();else if(this.selectionStart||"0"==this.selectionStart){var startPos=this.selectionStart,endPos=this.selectionEnd,scrollTop=this.scrollTop;this.value=this.value.substring(0,startPos)+myValue+this.value.substring(endPos,this.value.length),this.focus(),this.selectionStart=startPos+myValue.length,this.selectionEnd=startPos+myValue.length,this.scrollTop=scrollTop}else this.value+=myValue,this.focus()}))}}),$(".progress .progress-bar").css("width",(function(){return $(this).attr("aria-valuenow")+"%"})),ISPConfig.loadInitContent(),$("#searchform").submit((function(e){e.preventDefault()})),$("#pageForm").submit((function(e){$("#pageForm .table #Filter").length>0&&e.preventDefault()})),$.fn.setCursorPosition=function(pos){var self=$(this).get(0);if(self.setSelectionRange)self.setSelectionRange(pos,pos);else if(self.createTextRange){var range=self.createTextRange();range.collapse(!0),pos<0&&(pos=$(this).val().length+pos),range.moveEnd("character",pos),range.moveStart("character",pos),range.select()}},$.fn.getCursorPosition=function(){var iCaretPos=0,self=$(this).get(0);if("number"==typeof self.selectionStart)iCaretPos="backward"==self.selectionDirection?self.selectionStart:self.selectionEnd;else if(document.selection){this.focus();var oSel=document.selection.createRange();oSel.moveStart("character",-self.value.length),iCaretPos=oSel.text.length}return iCaretPos}}));